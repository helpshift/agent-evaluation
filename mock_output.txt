============================= test session starts ==============================
platform darwin -- Python 3.14.1, pytest-9.0.2, pluggy-1.6.0 -- /Users/rinit.lulla/.pyenv/versions/3.14.1/bin/python3.14
cachedir: .pytest_cache
rootdir: /Users/rinit.lulla/Documents/GitHub/agent-evaluation
plugins: anyio-4.12.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 5 items

tests/test_agent_eval_mocked.py::test_evaluate_agent_interaction_mocked[case0] FAILED
tests/test_agent_eval_mocked.py::test_evaluate_agent_interaction_mocked[case1] FAILED
tests/test_agent_eval_mocked.py::test_evaluate_agent_interaction_mocked[case2] FAILED
tests/test_agent_eval_mocked.py::test_evaluate_agent_interaction_mocked[case3] FAILED
tests/test_agent_eval_mocked.py::test_evaluate_agent_interaction_mocked[case4] FAILED

=================================== FAILURES ===================================
________________ test_evaluate_agent_interaction_mocked[case0] _________________

case = {'expected_response': 'The answer is 12.', 'expected_tools': ['add'], 'query': 'What is 5 plus 7?'}
sample_agent = LlmAgent(name='calculator_agent', description='', parent_agent=None, sub_agents=[], before_agent_callback=None, after_...back=None, after_model_callback=None, before_tool_callback=None, after_tool_callback=None, on_tool_error_callback=None)
evaluator_agent = LlmAgent(name='evaluator_agent', description='', parent_agent=None, sub_agents=[], before_agent_callback=None, after_a...back=None, after_model_callback=None, before_tool_callback=None, after_tool_callback=None, on_tool_error_callback=None)
session_service = <google.adk.sessions.in_memory_session_service.InMemorySessionService object at 0x12cb94d70>

    @pytest.mark.asyncio
    @pytest.mark.parametrize("case", load_dataset())
    async def test_evaluate_agent_interaction_mocked(case, sample_agent, evaluator_agent, session_service):
        user_query = case["query"]
        expected_response = case["expected_response"]
        expected_tools = case["expected_tools"]
    
        # --- Mock Sample Agent Execution ---
        # We want sample agent to "return" the expected response + expected tool call event
        sample_events = []
        for tool in expected_tools:
>           sample_events.append(create_tool_call_event(tool))
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_agent_eval_mocked.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tool_name = 'add'

    def create_tool_call_event(tool_name):
        fc = types.FunctionCall(name=tool_name, args={})
        content = types.Content(role="model", parts=[types.Part(function_call=fc)])
>       return Event(source="model", author="mock_agent", content=content)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       pydantic_core._pydantic_core.ValidationError: 1 validation error for Event
E       source
E         Extra inputs are not permitted [type=extra_forbidden, input_value='model', input_type=str]
E           For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden

tests/test_agent_eval_mocked.py:41: ValidationError
________________ test_evaluate_agent_interaction_mocked[case1] _________________

case = {'expected_response': 'The result is 50.', 'expected_tools': ['multiply'], 'query': 'Calculate 10 times 5.'}
sample_agent = LlmAgent(name='calculator_agent', description='', parent_agent=None, sub_agents=[], before_agent_callback=None, after_...back=None, after_model_callback=None, before_tool_callback=None, after_tool_callback=None, on_tool_error_callback=None)
evaluator_agent = LlmAgent(name='evaluator_agent', description='', parent_agent=None, sub_agents=[], before_agent_callback=None, after_a...back=None, after_model_callback=None, before_tool_callback=None, after_tool_callback=None, on_tool_error_callback=None)
session_service = <google.adk.sessions.in_memory_session_service.InMemorySessionService object at 0x106011310>

    @pytest.mark.asyncio
    @pytest.mark.parametrize("case", load_dataset())
    async def test_evaluate_agent_interaction_mocked(case, sample_agent, evaluator_agent, session_service):
        user_query = case["query"]
        expected_response = case["expected_response"]
        expected_tools = case["expected_tools"]
    
        # --- Mock Sample Agent Execution ---
        # We want sample agent to "return" the expected response + expected tool call event
        sample_events = []
        for tool in expected_tools:
>           sample_events.append(create_tool_call_event(tool))
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_agent_eval_mocked.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tool_name = 'multiply'

    def create_tool_call_event(tool_name):
        fc = types.FunctionCall(name=tool_name, args={})
        content = types.Content(role="model", parts=[types.Part(function_call=fc)])
>       return Event(source="model", author="mock_agent", content=content)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       pydantic_core._pydantic_core.ValidationError: 1 validation error for Event
E       source
E         Extra inputs are not permitted [type=extra_forbidden, input_value='model', input_type=str]
E           For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden

tests/test_agent_eval_mocked.py:41: ValidationError
________________ test_evaluate_agent_interaction_mocked[case2] _________________

case = {'expected_response': 'I cannot divide by zero.', 'expected_tools': ['divide'], 'query': 'What is 100 divided by 0?'}
sample_agent = LlmAgent(name='calculator_agent', description='', parent_agent=None, sub_agents=[], before_agent_callback=None, after_...back=None, after_model_callback=None, before_tool_callback=None, after_tool_callback=None, on_tool_error_callback=None)
evaluator_agent = LlmAgent(name='evaluator_agent', description='', parent_agent=None, sub_agents=[], before_agent_callback=None, after_a...back=None, after_model_callback=None, before_tool_callback=None, after_tool_callback=None, on_tool_error_callback=None)
session_service = <google.adk.sessions.in_memory_session_service.InMemorySessionService object at 0x12c9c2710>

    @pytest.mark.asyncio
    @pytest.mark.parametrize("case", load_dataset())
    async def test_evaluate_agent_interaction_mocked(case, sample_agent, evaluator_agent, session_service):
        user_query = case["query"]
        expected_response = case["expected_response"]
        expected_tools = case["expected_tools"]
    
        # --- Mock Sample Agent Execution ---
        # We want sample agent to "return" the expected response + expected tool call event
        sample_events = []
        for tool in expected_tools:
>           sample_events.append(create_tool_call_event(tool))
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_agent_eval_mocked.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tool_name = 'divide'

    def create_tool_call_event(tool_name):
        fc = types.FunctionCall(name=tool_name, args={})
        content = types.Content(role="model", parts=[types.Part(function_call=fc)])
>       return Event(source="model", author="mock_agent", content=content)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       pydantic_core._pydantic_core.ValidationError: 1 validation error for Event
E       source
E         Extra inputs are not permitted [type=extra_forbidden, input_value='model', input_type=str]
E           For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden

tests/test_agent_eval_mocked.py:41: ValidationError
________________ test_evaluate_agent_interaction_mocked[case3] _________________

case = {'expected_response': 'It is 30.', 'expected_tools': ['subtract'], 'query': 'Subtract 20 from 50.'}
sample_agent = LlmAgent(name='calculator_agent', description='', parent_agent=None, sub_agents=[], before_agent_callback=None, after_...back=None, after_model_callback=None, before_tool_callback=None, after_tool_callback=None, on_tool_error_callback=None)
evaluator_agent = LlmAgent(name='evaluator_agent', description='', parent_agent=None, sub_agents=[], before_agent_callback=None, after_a...back=None, after_model_callback=None, before_tool_callback=None, after_tool_callback=None, on_tool_error_callback=None)
session_service = <google.adk.sessions.in_memory_session_service.InMemorySessionService object at 0x12cb3a520>

    @pytest.mark.asyncio
    @pytest.mark.parametrize("case", load_dataset())
    async def test_evaluate_agent_interaction_mocked(case, sample_agent, evaluator_agent, session_service):
        user_query = case["query"]
        expected_response = case["expected_response"]
        expected_tools = case["expected_tools"]
    
        # --- Mock Sample Agent Execution ---
        # We want sample agent to "return" the expected response + expected tool call event
        sample_events = []
        for tool in expected_tools:
>           sample_events.append(create_tool_call_event(tool))
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_agent_eval_mocked.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

tool_name = 'subtract'

    def create_tool_call_event(tool_name):
        fc = types.FunctionCall(name=tool_name, args={})
        content = types.Content(role="model", parts=[types.Part(function_call=fc)])
>       return Event(source="model", author="mock_agent", content=content)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       pydantic_core._pydantic_core.ValidationError: 1 validation error for Event
E       source
E         Extra inputs are not permitted [type=extra_forbidden, input_value='model', input_type=str]
E           For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden

tests/test_agent_eval_mocked.py:41: ValidationError
________________ test_evaluate_agent_interaction_mocked[case4] _________________

case = {'expected_response': 'I can only help with math questions.', 'expected_tools': [], 'query': 'Who is the president of France?'}
sample_agent = LlmAgent(name='calculator_agent', description='', parent_agent=None, sub_agents=[], before_agent_callback=None, after_...back=None, after_model_callback=None, before_tool_callback=None, after_tool_callback=None, on_tool_error_callback=None)
evaluator_agent = LlmAgent(name='evaluator_agent', description='', parent_agent=None, sub_agents=[], before_agent_callback=None, after_a...back=None, after_model_callback=None, before_tool_callback=None, after_tool_callback=None, on_tool_error_callback=None)
session_service = <google.adk.sessions.in_memory_session_service.InMemorySessionService object at 0x12cb3a8b0>

    @pytest.mark.asyncio
    @pytest.mark.parametrize("case", load_dataset())
    async def test_evaluate_agent_interaction_mocked(case, sample_agent, evaluator_agent, session_service):
        user_query = case["query"]
        expected_response = case["expected_response"]
        expected_tools = case["expected_tools"]
    
        # --- Mock Sample Agent Execution ---
        # We want sample agent to "return" the expected response + expected tool call event
        sample_events = []
        for tool in expected_tools:
            sample_events.append(create_tool_call_event(tool))
>       sample_events.append(create_text_event(expected_response)) # Simulating correct behavior
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_agent_eval_mocked.py:55: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

text = 'I can only help with math questions.'

    def create_text_event(text):
        content = types.Content(role="model", parts=[types.Part(text=text)])
>       return Event(source="model", author="mock_agent", content=content)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       pydantic_core._pydantic_core.ValidationError: 1 validation error for Event
E       source
E         Extra inputs are not permitted [type=extra_forbidden, input_value='model', input_type=str]
E           For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden

tests/test_agent_eval_mocked.py:36: ValidationError
=============================== warnings summary ===============================
../../../.pyenv/versions/3.14.1/lib/python3.14/site-packages/google/genai/types.py:43
  /Users/rinit.lulla/.pyenv/versions/3.14.1/lib/python3.14/site-packages/google/genai/types.py:43: DeprecationWarning: '_UnionGenericAlias' is deprecated and slated for removal in Python 3.17
    VersionedUnionType = Union[builtin_types.UnionType, _UnionGenericAlias]

../../../.pyenv/versions/3.14.1/lib/python3.14/site-packages/fastapi/_compat/v1.py:72
  /Users/rinit.lulla/.pyenv/versions/3.14.1/lib/python3.14/site-packages/fastapi/_compat/v1.py:72: UserWarning: Core Pydantic V1 functionality isn't compatible with Python 3.14 or greater.
    from pydantic.v1 import BaseConfig as BaseConfig  # type: ignore[assignment]

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_agent_eval_mocked.py::test_evaluate_agent_interaction_mocked[case0]
FAILED tests/test_agent_eval_mocked.py::test_evaluate_agent_interaction_mocked[case1]
FAILED tests/test_agent_eval_mocked.py::test_evaluate_agent_interaction_mocked[case2]
FAILED tests/test_agent_eval_mocked.py::test_evaluate_agent_interaction_mocked[case3]
FAILED tests/test_agent_eval_mocked.py::test_evaluate_agent_interaction_mocked[case4]
======================== 5 failed, 2 warnings in 2.57s =========================
